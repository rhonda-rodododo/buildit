/**
 * @generated from protocol/schemas/modules/groups/v1.json
 * @version 1.0.0
 *
 * DO NOT EDIT - This file is auto-generated by tools/codegen
 * Zod validation schemas for the Groups module
 */

import { z } from "zod";

/** Group privacy/discovery level */
export const GroupPrivacyLevelSchema = z.enum(["public", "private", "secret"]);
export type GroupPrivacyLevel = z.infer<typeof GroupPrivacyLevelSchema>;

/** Member role within a group */
export const GroupRoleSchema = z.enum([
  "owner",
  "admin",
  "moderator",
  "member",
]);
export type GroupRole = z.infer<typeof GroupRoleSchema>;

/** Granular group permission */
export const GroupPermissionSchema = z.enum([
  "invite_members",
  "remove_members",
  "edit_group",
  "post_messages",
  "create_events",
  "manage_events",
  "vote",
  "create_proposals",
]);
export type GroupPermission = z.infer<typeof GroupPermissionSchema>;

/** Module identifier that can be enabled per-group */
export const GroupModuleSchema = z.enum([
  "custom-fields",
  "public",
  "messaging",
  "events",
  "mutual-aid",
  "governance",
  "wiki",
  "database",
  "crm",
  "documents",
  "files",
  "microblogging",
  "forms",
  "fundraising",
  "publishing",
  "newsletters",
  "hotlines",
]);
export type GroupModule = z.infer<typeof GroupModuleSchema>;

/** A member of a group with role and permissions */
export const GroupMemberSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    pubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
    role: GroupRoleSchema,
    joinedAt: z.number().int(),
    invitedBy: z.string().optional(),
    permissions: z.array(GroupPermissionSchema).optional(),
  })
  .passthrough();
export type GroupMember = z.infer<typeof GroupMemberSchema>;

/** A BuildIt group (organization, chapter, team) */
export const GroupSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    /** Deterministic ID based on creation event */
    id: z.string(),
    name: z.string().max(256),
    description: z.string().max(8192),
    picture: z.string().url().optional(),
    privacyLevel: GroupPrivacyLevelSchema,
    members: z.array(GroupMemberSchema),
    createdBy: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
    createdAt: z.number().int(),
    tags: z.array(z.string()).optional(),
    website: z.string().optional(),
    location: z.string().optional(),
    enabledModules: z.array(GroupModuleSchema),
    creationEventId: z.string(),
    metadataEventId: z.string().optional(),
  })
  .passthrough();
export type Group = z.infer<typeof GroupSchema>;

/** An invitation to join a group */
export const GroupInvitationSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    id: z.string(),
    groupId: z.string(),
    invitedPubkey: z.string(),
    invitedBy: z.string(),
    message: z.string().optional(),
    createdAt: z.number().int(),
    expiresAt: z.number().int().optional(),
    status: z.enum(["pending", "accepted", "declined", "expired"]),
  })
  .passthrough();
export type GroupInvitation = z.infer<typeof GroupInvitationSchema>;

/** Group configuration settings */
export const GroupSettingsSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    groupId: z.string(),
    discoverable: z.boolean(),
    requireApproval: z.boolean(),
    defaultRole: GroupRoleSchema,
    defaultPermissions: z.array(GroupPermissionSchema),
    allowDirectMessages: z.boolean().optional(),
    allowThreads: z.boolean().optional(),
    moduleSettings: z.record(z.string(), z.any()).optional(),
  })
  .passthrough();
export type GroupSettings = z.infer<typeof GroupSettingsSchema>;

/** A discussion thread within a group */
export const GroupThreadSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    id: z.string(),
    groupId: z.string(),
    title: z.string(),
    createdBy: z.string(),
    createdAt: z.number().int(),
    lastMessageAt: z.number().int(),
    messageCount: z.number().int(),
    category: z.string().optional(),
    pinned: z.boolean().optional(),
  })
  .passthrough();
export type GroupThread = z.infer<typeof GroupThreadSchema>;

/** A message within a group thread */
export const GroupMessageSchema = z
  .object({
    _v: z.string().default("1.0.0"),
    id: z.string(),
    threadId: z.string(),
    groupId: z.string(),
    from: z.string(),
    content: z.string(),
    timestamp: z.number().int(),
    replyTo: z.string().optional(),
    reactions: z.record(z.string(), z.array(z.string())).optional(),
    edited: z.boolean().optional(),
    editedAt: z.number().int().optional(),
    deleted: z.boolean().optional(),
  })
  .passthrough();
export type GroupMessage = z.infer<typeof GroupMessageSchema>;

/** Module version */
export const GROUPS_SCHEMA_VERSION = "1.0.0" as const;
