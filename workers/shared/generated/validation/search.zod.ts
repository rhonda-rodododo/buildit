/**
 * @generated from protocol/schemas/modules/search/v1.json
 * @version 1.0.0
 *
 * DO NOT EDIT - This file is auto-generated by tools/codegen
 * Zod validation schemas for the Search module
 */

import { z } from "zod";

/** Facet value types - string, number, boolean, string array, or range */
export const FacetValueSchema = z.union([
  z.string(),
  z.number(),
  z.boolean(),
  z.array(z.string()),
  z.object({ min: z.number(), max: z.number() }).strict(),
]);
export type FacetValue = z.infer<typeof FacetValueSchema>;

/** Defines the scope of a search query */
export const SearchScopeSchema = z.union([
  z.object({ type: z.literal("global") }).strict(),
  z.object({ type: z.literal("group"), groupId: z.string() }).strict(),
  z.object({ type: z.literal("module"), moduleType: z.string() }).strict(),
  z
    .object({
      type: z.literal("module-in-group"),
      moduleType: z.string(),
      groupId: z.string(),
    })
    .strict(),
]);
export type SearchScope = z.infer<typeof SearchScopeSchema>;

/** Sparse vector representation for TF-IDF - maps term index to weight */
export const SparseVectorSchema = z.object({});
export type SparseVector = z.infer<typeof SparseVectorSchema>;

/** A document indexed for search - internal representation stored in search index */
export const SearchDocumentSchema = z
  .object({
    /** Schema version */
    _v: z.string().regex(new RegExp("^\\d+\\.\\d+\\.\\d+$")),
    /** Unique document ID (format: moduleType:entityId) */
    id: z.string().regex(new RegExp("^[a-z-]+:[a-zA-Z0-9-]+$")),
    /** Source module type (messaging, documents, events, wiki, etc.) */
    moduleType: z.string(),
    /** Original entity ID in the source module */
    entityId: z.string(),
    /** Group this document belongs to */
    groupId: z.string(),
    /** Searchable title/name */
    title: z.string().max(500),
    /** Searchable content body (plaintext, HTML stripped) */
    content: z.string().max(1000000),
    /** Tags associated with this document */
    tags: z.array(z.string()).max(100).optional(),
    /** Short excerpt for display in search results */
    excerpt: z.string().max(500).optional(),
    /** Author/creator pubkey */
    authorPubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")).optional(),
    /** Module-specific facets for filtering */
    facets: z.record(z.string(), FacetValueSchema).optional(),
    /** TF-IDF vector for semantic search (optional) */
    vector: SparseVectorSchema.optional(),
    /** When the source entity was created (Unix timestamp ms) */
    createdAt: z.number().int(),
    /** When the source entity was last updated (Unix timestamp ms) */
    updatedAt: z.number().int(),
    /** When this document was indexed (Unix timestamp ms) */
    indexedAt: z.number().int(),
  })
  .passthrough();
export type SearchDocument = z.infer<typeof SearchDocumentSchema>;

/** Defines a filterable facet for a module */
export const FacetDefinitionSchema = z
  .object({
    /** Facet key/identifier */
    key: z.string(),
    /** Display label for the facet */
    label: z.string(),
    /** Type of facet */
    type: z.enum(["keyword", "range", "date", "boolean", "hierarchy"]),
    /** For hierarchical facets, the parent facet key */
    parentKey: z.string().optional(),
    /** Whether multiple values can be selected */
    multiSelect: z.boolean(),
  })
  .passthrough();
export type FacetDefinition = z.infer<typeof FacetDefinitionSchema>;

/** Filter extracted from query or applied via UI */
export const QueryFilterSchema = z
  .object({
    /** Filter field (e.g., 'author', 'date', 'tag') */
    field: z.string(),
    /** Filter operator */
    operator: z.enum([
      "eq",
      "ne",
      "gt",
      "lt",
      "gte",
      "lte",
      "contains",
      "in",
      "range",
    ]),
    /** Filter value */
    value: FacetValueSchema,
  })
  .passthrough();
export type QueryFilter = z.infer<typeof QueryFilterSchema>;

/** Parsed and normalized search query */
export const ParsedQuerySchema = z
  .object({
    /** Original raw query string */
    raw: z.string(),
    /** Extracted keywords (stemmed) */
    keywords: z.array(z.string()),
    /** Exact phrase matches (quoted) */
    phrases: z.array(z.string()),
    /** Expanded synonyms */
    expandedTerms: z.array(z.string()).optional(),
    /** Detected filters from query syntax */
    filters: z.array(QueryFilterSchema),
    /** Active search scope */
    scope: SearchScopeSchema,
  })
  .passthrough();
export type ParsedQuery = z.infer<typeof ParsedQuerySchema>;

/** A search result with relevance scoring */
export const SearchResultSchema = z
  .object({
    /** The matching document */
    document: SearchDocumentSchema,
    /** Relevance score (higher is better) */
    score: z.number(),
    /** Matched terms for highlighting */
    matchedTerms: z.array(z.string()),
    /** Fields where matches were found */
    matchedFields: z.array(z.string()),
    /** Highlighted excerpt with match markers */
    highlightedExcerpt: z.string().optional(),
  })
  .passthrough();
export type SearchResult = z.infer<typeof SearchResultSchema>;

/** Aggregated facet counts for filtering UI */
export const FacetCountsSchema = z
  .object({
    /** Module type distribution */
    moduleType: z.record(z.string(), z.number().int()).optional(),
    /** Group distribution */
    groups: z.record(z.string(), z.number().int()).optional(),
    /** Tag distribution */
    tags: z.record(z.string(), z.number().int()).optional(),
    /** Date histogram (by day) */
    dates: z.record(z.string(), z.number().int()).optional(),
    /** Author distribution */
    authors: z.record(z.string(), z.number().int()).optional(),
    /** Module-specific facet counts */
    custom: z
      .record(z.string(), z.record(z.string(), z.number().int()))
      .optional(),
  })
  .passthrough();
export type FacetCounts = z.infer<typeof FacetCountsSchema>;

/** Aggregated search results */
export const SearchResultsSchema = z
  .object({
    /** Matching results */
    results: z.array(SearchResultSchema),
    /** Total count (may exceed results.length for pagination) */
    totalCount: z.number().int(),
    /** Facet counts for filtering UI */
    facetCounts: FacetCountsSchema.optional(),
    /** Search execution time in milliseconds */
    searchTimeMs: z.number(),
    /** Query that produced these results */
    query: ParsedQuerySchema,
  })
  .passthrough();
export type SearchResults = z.infer<typeof SearchResultsSchema>;

/** Active facet filters for search */
export const FacetFiltersSchema = z
  .object({
    /** Filter by module types */
    moduleTypes: z.array(z.string()).optional(),
    /** Filter by group IDs */
    groupIds: z.array(z.string()).optional(),
    /** Filter by tags */
    tags: z.array(z.string()).optional(),
    /** Filter by date range (Unix timestamps) */
    dateRange: z
      .object({ start: z.number().int(), end: z.number().int() })
      .optional(),
    /** Filter by author pubkeys */
    authors: z.array(z.string()).optional(),
    /** Custom facet filters by key */
    custom: z.record(z.string(), z.array(FacetValueSchema)).optional(),
  })
  .passthrough();
export type FacetFilters = z.infer<typeof FacetFiltersSchema>;

/** User-defined tag for organizing content */
export const TagSchema = z
  .object({
    /** Schema version */
    _v: z.string().regex(new RegExp("^\\d+\\.\\d+\\.\\d+$")),
    /** Unique tag ID */
    id: z.string(),
    /** Group this tag belongs to */
    groupId: z.string(),
    /** Tag display name */
    name: z.string().max(100),
    /** URL-safe slug */
    slug: z.string().regex(new RegExp("^[a-z0-9-]+$")).max(100),
    /** Optional tag color (hex) */
    color: z.string().regex(new RegExp("^#[0-9a-fA-F]{6}$")).optional(),
    /** Parent tag ID for hierarchical tags */
    parentTagId: z.string().optional(),
    /** Number of entities using this tag */
    usageCount: z.number().int().gte(0),
    /** Creation timestamp (Unix ms) */
    createdAt: z.number().int(),
    /** Creator pubkey */
    createdBy: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
    /** Last update timestamp (Unix ms) */
    updatedAt: z.number().int(),
  })
  .passthrough();
export type Tag = z.infer<typeof TagSchema>;

/** Association between an entity and a tag */
export const EntityTagSchema = z
  .object({
    /** Schema version */
    _v: z.string().regex(new RegExp("^\\d+\\.\\d+\\.\\d+$")),
    /** Unique association ID */
    id: z.string(),
    /** Module type of the tagged entity */
    entityType: z.string(),
    /** ID of the tagged entity */
    entityId: z.string(),
    /** Tag ID */
    tagId: z.string(),
    /** Group ID */
    groupId: z.string(),
    /** Creation timestamp (Unix ms) */
    createdAt: z.number().int(),
    /** Creator pubkey */
    createdBy: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
  })
  .passthrough();
export type EntityTag = z.infer<typeof EntityTagSchema>;

/** Saved search query for quick access */
export const SavedSearchSchema = z
  .object({
    /** Schema version */
    _v: z.string().regex(new RegExp("^\\d+\\.\\d+\\.\\d+$")),
    /** Unique saved search ID */
    id: z.string(),
    /** User who saved this search */
    userPubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
    /** Display name for the saved search */
    name: z.string().max(100),
    /** Search query string */
    query: z.string(),
    /** Search scope */
    scope: SearchScopeSchema,
    /** Active filters */
    filters: FacetFiltersSchema.optional(),
    /** Creation timestamp */
    createdAt: z.number().int(),
    /** Last update timestamp */
    updatedAt: z.number().int(),
    /** Last use timestamp */
    lastUsedAt: z.number().int().optional(),
    /** Number of times this search has been used */
    useCount: z.number().int().gte(0),
  })
  .passthrough();
export type SavedSearch = z.infer<typeof SavedSearchSchema>;

/** Recent search entry for history */
export const RecentSearchSchema = z
  .object({
    /** Schema version */
    _v: z.string().regex(new RegExp("^\\d+\\.\\d+\\.\\d+$")),
    /** Unique entry ID */
    id: z.string(),
    /** User pubkey */
    userPubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
    /** Search query */
    query: z.string(),
    /** Search scope */
    scope: SearchScopeSchema,
    /** When the search was performed */
    timestamp: z.number().int(),
    /** Number of results returned */
    resultCount: z.number().int().gte(0),
  })
  .passthrough();
export type RecentSearch = z.infer<typeof RecentSearchSchema>;

/** Configuration for a module's search provider */
export const SearchProviderConfigSchema = z
  .object({
    /** Module type this provider handles */
    moduleType: z.string(),
    /** Whether this provider is active */
    enabled: z.boolean(),
    /** Facets this module provides */
    facetDefinitions: z.array(FacetDefinitionSchema),
    /** Result boost factor for this module (default: 1.0) */
    boost: z.number().gte(0).lte(10).optional(),
  })
  .passthrough();
export type SearchProviderConfig = z.infer<typeof SearchProviderConfigSchema>;

/** Options for fine-tuning search behavior */
export const SearchOptionsSchema = z
  .object({
    /** Maximum results to return */
    limit: z.number().int().gte(1).lte(1000).optional(),
    /** Results to skip (pagination) */
    offset: z.number().int().gte(0).optional(),
    /** Enable fuzzy matching */
    fuzzy: z.boolean().optional(),
    /** Fuzzy match threshold (0-1) */
    fuzzyThreshold: z.number().gte(0).lte(1).optional(),
    /** Enable prefix matching */
    prefix: z.boolean().optional(),
    /** Field boost weights */
    boost: z.record(z.string(), z.number()).optional(),
    /** Enable semantic/TF-IDF search */
    semantic: z.boolean().optional(),
    /** Semantic search weight (0-1), default 0.3 */
    semanticWeight: z.number().gte(0).lte(1).optional(),
    /** Highlight matched terms in results */
    highlight: z.boolean().optional(),
  })
  .passthrough();
export type SearchOptions = z.infer<typeof SearchOptionsSchema>;

/** Statistics about the search index */
export const IndexStatsSchema = z
  .object({
    /** Total documents indexed */
    totalDocuments: z.number().int().gte(0),
    /** Documents by module type */
    byModuleType: z.record(z.string(), z.number().int()),
    /** Documents by group */
    byGroup: z.record(z.string(), z.number().int()),
    /** Total unique terms in index */
    uniqueTerms: z.number().int().gte(0),
    /** Estimated index size in bytes */
    sizeBytes: z.number().int().gte(0),
    /** Last full reindex timestamp */
    lastFullReindex: z.number().int().optional(),
    /** Last incremental update timestamp */
    lastIncrementalUpdate: z.number().int().optional(),
  })
  .passthrough();
export type IndexStats = z.infer<typeof IndexStatsSchema>;

/** Concept expansion for semantic search in organizing contexts */
export const ConceptExpansionSchema = z
  .object({
    /** Primary term */
    term: z.string(),
    /** Related/synonym terms */
    synonyms: z.array(z.string()),
    /** Broader concept */
    broader: z.string().optional(),
    /** Narrower concepts */
    narrower: z.array(z.string()).optional(),
  })
  .passthrough();
export type ConceptExpansion = z.infer<typeof ConceptExpansionSchema>;

/** Module version */
export const SEARCH_SCHEMA_VERSION = "1.0.0" as const;
