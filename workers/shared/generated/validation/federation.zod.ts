/**
 * @generated from protocol/schemas/modules/federation/v1.json
 * @version 1.0.0
 *
 * DO NOT EDIT - This file is auto-generated by tools/codegen
 * Zod validation schemas for the Federation module
 */

import { z } from "zod";

/** Per-identity federation configuration */
export const FederationConfigSchema = z.object({
  /** Schema version for graceful degradation */
  _v: z.string().default("1.0.0"),
  /** Hex-encoded Nostr public key */
  nostrPubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
  /** Federation username (e.g., user@buildit.network) */
  username: z
    .string()
    .regex(new RegExp("^[a-zA-Z0-9_-]+$"))
    .min(1)
    .max(64)
    .optional(),
  /** Whether ActivityPub federation is enabled */
  apEnabled: z.boolean().default(false),
  /** Whether AT Protocol (Bluesky) federation is enabled */
  atEnabled: z.boolean().default(false),
  /** Bluesky handle (e.g., user.bsky.social) */
  atHandle: z.union([z.string(), z.null()]).optional(),
});
export type FederationConfig = z.infer<typeof FederationConfigSchema>;

/** Federation status for a specific post/event */
export const FederationStatusSchema = z.object({
  /** Schema version for graceful degradation */
  _v: z.string().default("1.0.0"),
  /** The Nostr event ID this status refers to */
  nostrEventId: z.string(),
  /** Whether this event has been federated via ActivityPub */
  apFederated: z.boolean().default(false),
  /** The AP activity ID if federated */
  apActivityId: z.union([z.string(), z.null()]).optional(),
  /** Whether this event has been cross-posted to AT Protocol */
  atFederated: z.boolean().default(false),
  /** The AT Protocol URI if cross-posted */
  atUri: z.union([z.string(), z.null()]).optional(),
  /** ISO 8601 timestamp of when the event was federated */
  federatedAt: z
    .union([z.string().datetime({ offset: true }), z.null()])
    .optional(),
});
export type FederationStatus = z.infer<typeof FederationStatusSchema>;

/** An incoming interaction from a federated platform */
export const FederationInteractionSchema = z.object({
  /** Schema version for graceful degradation */
  _v: z.string().default("1.0.0"),
  /** Unique interaction ID */
  id: z.number().int().optional(),
  /** The Nostr event this interaction targets */
  targetNostrEventId: z.union([z.string(), z.null()]).optional(),
  /** Which federated protocol this came from */
  sourceProtocol: z.enum(["activitypub", "atproto"]),
  /** The remote actor's identifier (AP actor URI or AT DID) */
  sourceActorId: z.string(),
  /** Human-readable name of the remote actor */
  sourceActorName: z.union([z.string(), z.null()]).optional(),
  /** Type of interaction */
  interactionType: z.enum(["reply", "like", "repost"]),
  /** Content of the interaction (e.g., reply text) */
  content: z.union([z.string(), z.null()]).optional(),
  /** URL to the interaction on its home platform */
  sourceUrl: z.union([z.string(), z.null()]).optional(),
  /** When BuildIt received this interaction */
  receivedAt: z.string().datetime({ offset: true }).optional(),
});
export type FederationInteraction = z.infer<typeof FederationInteractionSchema>;

/** Maps a Nostr pubkey to ActivityPub and AT Protocol accounts */
export const FederationIdentitySchema = z.object({
  _v: z.string().default("1.0.0"),
  nostrPubkey: z.string().regex(new RegExp("^[0-9a-f]{64}$")),
  username: z.string(),
  apEnabled: z.boolean(),
  apActorId: z.union([z.string(), z.null()]).optional(),
  /** Encrypted AP private key */
  apPrivateKey: z.union([z.string(), z.null()]).optional(),
  atEnabled: z.boolean(),
  atDid: z.union([z.string(), z.null()]).optional(),
  atHandle: z.union([z.string(), z.null()]).optional(),
  atSessionEncrypted: z.union([z.string(), z.null()]).optional(),
  createdAt: z.string().datetime({ offset: true }),
  updatedAt: z.string().datetime({ offset: true }),
});
export type FederationIdentity = z.infer<typeof FederationIdentitySchema>;

/** ActivityPub follower relationship record */
export const APFollowerSchema = z.object({
  _v: z.string().default("1.0.0"),
  id: z.number().int().optional(),
  /** Local actor username */
  localActor: z.string(),
  /** Remote AP actor URI */
  remoteActorId: z.string(),
  /** Remote actor's inbox URL */
  remoteInbox: z.string(),
  /** Remote actor's shared inbox URL */
  remoteSharedInbox: z.union([z.string(), z.null()]).optional(),
  acceptedAt: z.string().datetime({ offset: true }),
});
export type APFollower = z.infer<typeof APFollowerSchema>;

/** Tracks a post federated across Nostr, AP, and AT Protocol */
export const FederatedPostSchema = z.object({
  _v: z.string().default("1.0.0"),
  nostrEventId: z.string(),
  nostrPubkey: z.string(),
  apActivityId: z.union([z.string(), z.null()]).optional(),
  atUri: z.union([z.string(), z.null()]).optional(),
  atCid: z.union([z.string(), z.null()]).optional(),
  federatedAt: z.string().datetime({ offset: true }),
});
export type FederatedPost = z.infer<typeof FederatedPostSchema>;

/** Module version */
export const FEDERATION_SCHEMA_VERSION = "1.0.0" as const;
