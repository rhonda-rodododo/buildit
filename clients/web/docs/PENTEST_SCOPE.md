# Penetration Testing Scope Document

**Version**: 0.30.0
**Last Updated**: 2025-10-07
**Audit Firm**: TBD (Trail of Bits, Cure53, or NCC Group recommended)
**Estimated Timeline**: 2-3 weeks
**Budget**: $30,000-$60,000 (estimated)

## Executive Summary

BuildIt Network is a privacy-first organizing platform built on the Nostr protocol with end-to-end encryption. This document defines the scope for a comprehensive security audit before production deployment.

**Primary Security Concerns**:
1. Encryption implementation correctness (NIP-44, NIP-17, NIP-59)
2. Key management and storage security
3. Web application security (XSS, CSRF, etc.)
4. Metadata protection effectiveness
5. Supply chain security

## Application Overview

**Type**: Single-page web application (React + TypeScript)
**Protocol**: Nostr (decentralized social protocol)
**Encryption**: NIP-44 (ChaCha20-Poly1305), AES-256-GCM
**Storage**: Client-side only (IndexedDB + localStorage)
**Dependencies**: See [DEPENDENCIES.md](./DEPENDENCIES.md)

## In-Scope Components

### 1. Cryptographic Implementations (Critical Priority)

#### 1.1 NIP-44 Encryption
**Files**:
- `/src/core/crypto/nip44.ts`
- `/src/core/crypto/__tests__/nip44.test.ts`

**Focus Areas**:
- Conversation key derivation (ECDH + HKDF)
- Encryption/decryption correctness
- Nonce generation and uniqueness
- Error handling and information leakage
- Constant-time operations (timing attacks)

**Test Vectors**: nostr-tools test suite + custom vectors

#### 1.2 NIP-17 Gift Wrap (Metadata Protection)
**Files**:
- `/src/core/crypto/nip17.ts`
- `/src/core/crypto/__tests__/nip17.test.ts`

**Focus Areas**:
- Ephemeral key generation and usage
- Timestamp randomization effectiveness
- Sender unlinkability verification
- Multi-layer encryption correctness
- Group message handling

#### 1.3 Media Encryption
**Files**:
- `/src/lib/media/mediaEncryption.ts`
- `/src/lib/media/__tests__/mediaEncryption.test.ts`

**Focus Areas**:
- AES-256-GCM implementation
- IV generation and uniqueness
- Key distribution via NIP-17
- File integrity verification
- Memory safety (key zeroization)

### 2. Key Management (Critical Priority)

#### 2.1 Key Generation
**Files**:
- `/src/core/crypto/keyManager.ts`
- `/src/stores/authStore.ts`

**Focus Areas**:
- Entropy source quality (WebCrypto CSPRNG)
- Key generation randomness
- Private key validation
- secp256k1 parameter validation

#### 2.2 Key Storage
**Files**:
- `/src/stores/authStore.ts`
- `/src/core/storage/db.ts`

**Focus Areas**:
- IndexedDB security (browser sandboxing)
- Key encoding (hex) - plaintext storage risk
- Memory handling (key cleanup on logout)
- Cross-origin isolation verification
- localStorage usage (public data only)

#### 2.3 Key Import/Export
**Files**:
- `/src/core/crypto/keyManager.ts`

**Focus Areas**:
- nsec encoding/decoding correctness
- Import validation
- Export safety (user awareness)
- Error handling

### 3. Database Encryption (High Priority)

**Files**:
- `/src/core/storage/encryption.ts`
- `/src/tests/integration/encryptionStorage.test.ts`

**Focus Areas**:
- Dexie hook implementation
- Field-level encryption correctness
- Group key derivation
- Error handling (failed encryption/decryption)
- Performance impact

### 4. Web Application Security (High Priority)

#### 4.1 XSS (Cross-Site Scripting)
**Focus Areas**:
- User-generated content rendering (markdown, posts, messages)
- Group names and descriptions
- File names and metadata
- CSP effectiveness
- DOM-based XSS in React components

#### 4.2 CSRF (Cross-Site Request Forgery)
**Focus Areas**:
- Stateless architecture (no cookies)
- SameSite configuration (if any cookies)
- Origin validation

#### 4.3 Authentication & Authorization
**Files**:
- `/src/stores/authStore.ts`
- `/src/hooks/useAuth.ts`

**Focus Areas**:
- Session management
- Identity switching
- Logout completeness (memory cleanup)
- Permission enforcement
- Role-based access control

#### 4.4 Input Validation
**Focus Areas**:
- Form validation (react-hook-form + zod)
- URL parsing and handling
- File upload validation
- JSON parsing safety

### 5. Rate Limiting & Session Management (Medium Priority)

**Files**:
- `/src/lib/rateLimit.ts`
- `/src/lib/sessionTimeout.ts`

**Focus Areas**:
- Rate limit bypass attempts
- Distributed rate limiting (if needed)
- Session timeout correctness
- Auto-lock effectiveness
- Replay attack prevention

### 6. Content Security Policy (Medium Priority)

**Files**:
- `/vite.config.ts`
- `/public/index.html` (if CSP meta tags)

**Focus Areas**:
- CSP directive correctness
- Inline script/style restrictions
- External resource whitelisting
- nonce/hash implementation (if applicable)
- CSP reporting configuration

### 7. Third-Party Dependencies (Medium Priority)

**Reference**: [DEPENDENCIES.md](./DEPENDENCIES.md)

**Focus Areas**:
- Known vulnerabilities (`bun audit`)
- Supply chain attack vectors
- Dependency integrity (lock file)
- Subresource Integrity (SRI) for CDN assets
- Update strategy

## Out-of-Scope Components

The following are explicitly out of scope:

### Infrastructure
- ❌ Nostr relay security (third-party services)
- ❌ DNS/domain security
- ❌ CDN configuration
- ❌ SSL/TLS certificate management (handled by hosting)

### External Services
- ❌ GitHub repository security
- ❌ CI/CD pipeline security (can be added as separate scope)
- ❌ Email service security (if used)

### Client-Side
- ❌ Browser security (assumed trusted)
- ❌ Operating system security
- ❌ Physical device security
- ❌ User operational security (education responsibility)

### Features Not Implemented
- ❌ Tor integration (planned, not yet implemented)
- ❌ Hardware wallet support (NIP-46 - planned)
- ❌ Password-based key encryption (planned Phase 2)
- ❌ WebAuthn implementation (planned Phase 2)

### Legal/Compliance
- ❌ GDPR compliance review (separate legal audit)
- ❌ CCPA compliance review
- ❌ Terms of Service legal review

## Testing Approach

### 1. Code Review (Manual)
- Review cryptographic implementations
- Check for common vulnerabilities (OWASP Top 10)
- Examine error handling and logging
- Assess security headers and CSP
- Review dependency usage

### 2. Dynamic Testing
- Black-box testing of web application
- Gray-box testing with source code access
- Fuzz testing of input validation
- Session management testing
- Authentication/authorization bypass attempts

### 3. Cryptographic Analysis
- Test vector verification
- Known-answer tests for NIPs
- Randomness quality assessment
- Timing attack resistance
- Side-channel analysis (if feasible)

### 4. Metadata Analysis
- NIP-17 sender anonymity verification
- Timestamp randomization effectiveness
- Traffic pattern analysis
- Relay visibility assessment

## Test Methodology

### OWASP Testing Guide v4.2
- Information Gathering
- Configuration and Deployment Management Testing
- Identity Management Testing
- Authentication Testing
- Authorization Testing
- Session Management Testing
- Input Validation Testing
- Error Handling Testing
- Cryptography Testing
- Business Logic Testing
- Client-Side Testing

### Additional Standards
- NIST SP 800-115 (Technical Guide to Information Security Testing)
- PTES (Penetration Testing Execution Standard)
- OSSTMM (Open Source Security Testing Methodology Manual)

## Deliverables

### 1. Executive Summary
- High-level findings and risk assessment
- Business impact analysis
- Prioritized recommendations

### 2. Technical Report
- Detailed vulnerability descriptions
- Proof of concept code/steps
- CVSS scores for each finding
- Remediation recommendations
- Verification steps

### 3. Remediation Report (After Fixes)
- Verification of fixes
- Remaining risks
- Final security posture assessment

### 4. Testing Artifacts
- Test scripts and tools used
- Network traffic captures (if applicable)
- Screenshots and evidence

## Severity Definitions

### Critical (CVSS 9.0-10.0)
- Private key exposure
- Authentication bypass
- Encryption weakness allowing plaintext recovery
- Remote code execution

### High (CVSS 7.0-8.9)
- XSS (stored)
- CSRF on sensitive operations
- Authorization bypass
- Key derivation weakness

### Medium (CVSS 4.0-6.9)
- XSS (reflected)
- Information disclosure
- Session fixation
- Missing security headers

### Low (CVSS 0.1-3.9)
- Best practice violations
- Low-impact information disclosure
- Clickjacking on non-sensitive pages

## Testing Environment

### Production-Like Environment
- URL: [staging.builditnetwork.org]
- Version: v0.30.0
- Access: Provided to audit team
- Test accounts: Provided with various permission levels

### Source Code Access
- Repository: [GitHub URL]
- Branch: `main` (production code)
- Documentation: See `/docs` directory

### Test Accounts
- Standard user (no special permissions)
- Group admin (group management)
- Multiple test groups (various configurations)

## Timeline

**Total Duration**: 2-3 weeks

**Week 1**:
- Onboarding and setup
- Code review (cryptographic implementations)
- Initial vulnerability scanning

**Week 2**:
- Dynamic testing (web application)
- Cryptographic analysis
- Metadata analysis

**Week 3**:
- Retest fixes (if needed)
- Report writing
- Debrief presentation

## Budget Estimate

**Audit Cost**: $30,000-$60,000
- Trail of Bits: ~$50,000-$60,000 (2 auditors, 3 weeks)
- Cure53: ~$40,000-$50,000 (2 auditors, 2-3 weeks)
- NCC Group: ~$45,000-$55,000 (2 auditors, 3 weeks)

**Additional Costs**:
- Remediation development time
- Retest (if major findings)

## Success Criteria

- ✅ No critical vulnerabilities
- ✅ <3 high severity findings
- ✅ All medium/high findings have remediation plan
- ✅ Cryptographic implementations verified correct
- ✅ Metadata protection effectiveness confirmed
- ✅ Web application security posture acceptable for production

## Contact

**Project Lead**: [Name]
**Email**: security@builditnetwork.org
**GitHub**: https://github.com/builditnetwork/buildit-network

## References

1. [ENCRYPTION_IMPLEMENTATION.md](./ENCRYPTION_IMPLEMENTATION.md)
2. [KEY_MANAGEMENT.md](./KEY_MANAGEMENT.md)
3. [PRIVACY.md](../PRIVACY.md)
4. [DEPENDENCIES.md](./DEPENDENCIES.md)
5. [VULNERABILITY_DISCLOSURE.md](./VULNERABILITY_DISCLOSURE.md)
6. [NIP-44 Specification](https://github.com/nostr-protocol/nips/blob/master/44.md)
7. [NIP-17 Specification](https://github.com/nostr-protocol/nips/blob/master/17.md)
8. [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)

---

**Document Status**: Ready for external audit firm review
**Next Step**: Engage audit firm and schedule kickoff
