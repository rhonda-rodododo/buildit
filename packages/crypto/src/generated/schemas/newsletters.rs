//! Newsletters module schema types
//!
//! @generated from protocol/schemas/modules/newsletters/v1.json
//! Version: 1.0.0
//! Min Reader Version: 1.0.0
//!
//! DO NOT EDIT - This file is auto-generated by tools/codegen using quicktype

use serde::{Deserialize, Serialize};

/// Schema version for Newsletters module
pub const NEWSLETTERS_VERSION: &str = "1.0.0";
/// Minimum reader version for Newsletters module
pub const NEWSLETTERS_MIN_READER_VERSION: &str = "1.0.0";

use std::collections::HashMap;

/// A newsletter/mailing list configuration
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Newsletter {
    #[serde(rename = "_v")]
    pub v: String,

    pub created_at: i64,

    pub description: Option<String>,

    /// Require email confirmation for subscriptions
    pub double_opt_in: Option<bool>,

    pub editors: Option<Vec<String>>,

    /// Sender display name
    pub from_name: Option<String>,

    pub group_id: Option<String>,

    pub id: String,

    pub logo: Option<String>,

    pub name: String,

    pub owner_pubkey: String,

    pub reply_to: Option<String>,

    pub subscriber_count: Option<i64>,

    pub visibility: Option<Visibility>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Visibility {
    Group,

    Private,

    Public,
}

/// An email campaign/issue
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Campaign {
    #[serde(rename = "_v")]
    pub v: String,

    pub click_count: Option<i64>,

    /// Email content (HTML or markdown)
    pub content: String,

    pub content_type: Option<ContentType>,

    pub created_at: i64,

    pub created_by: String,

    pub id: String,

    /// Signal-style encrypted link previews for URLs in campaign content
    pub link_previews: Option<Vec<LinkPreview>>,

    pub newsletter_id: String,

    pub open_count: Option<i64>,

    /// Preview text shown in email clients
    pub preheader: Option<String>,

    /// Number of recipients
    pub recipient_count: Option<i64>,

    /// Scheduled send time
    pub scheduled_at: Option<i64>,

    /// Subscriber segments to send to
    pub segments: Option<Vec<String>>,

    /// Actual send time
    pub sent_at: Option<i64>,

    pub status: Option<CampaignStatus>,

    pub subject: String,

    pub updated_at: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum ContentType {
    Html,

    Markdown,
}

/// Privacy-preserving link preview (Signal-style). Sender fetches OG metadata + thumbnail,
/// encrypts with content. Recipients see static previews — zero third-party requests.
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct LinkPreview {
    /// Open Graph og:description
    pub description: Option<String>,

    /// Base64-encoded favicon (max ~10KB)
    pub favicon_data: Option<String>,

    /// Favicon MIME type
    pub favicon_type: Option<String>,

    /// Unix timestamp when preview was generated
    pub fetched_at: i64,

    /// Who fetched the preview — sender (direct) or proxy (API worker)
    pub fetched_by: FetchedBy,

    /// Base64-encoded thumbnail (max ~50KB, encrypted with content)
    pub image_data: Option<String>,

    /// Image height in pixels
    pub image_height: Option<i64>,

    /// MIME type (image/jpeg, image/png, image/webp)
    pub image_type: Option<String>,

    /// Image width in pixels
    pub image_width: Option<i64>,

    /// Open Graph og:site_name
    pub site_name: Option<String>,

    /// Open Graph og:title
    pub title: Option<String>,

    /// Original URL
    pub url: String,
}

/// Who fetched the preview — sender (direct) or proxy (API worker)
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum FetchedBy {
    Proxy,

    Sender,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum CampaignStatus {
    Draft,

    Failed,

    Scheduled,

    Sending,

    Sent,
}

/// A newsletter subscriber
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Subscriber {
    #[serde(rename = "_v")]
    pub v: String,

    pub confirmed_at: Option<i64>,

    pub custom_fields: Option<HashMap<String, Option<serde_json::Value>>>,

    pub email: String,

    pub id: String,

    pub name: Option<String>,

    pub newsletter_id: String,

    /// BuildIt user pubkey if linked
    pub pubkey: Option<String>,

    /// Segments this subscriber belongs to
    pub segments: Option<Vec<String>>,

    /// How subscriber was acquired
    pub source: Option<String>,

    pub status: SubscriberStatus,

    pub subscribed_at: i64,

    pub unsubscribed_at: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum SubscriberStatus {
    Active,

    Bounced,

    Complained,

    Pending,

    Unsubscribed,
}

/// An email template
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Template {
    #[serde(rename = "_v")]
    pub v: String,

    pub content: String,

    pub content_type: Option<ContentType>,

    pub created_at: i64,

    pub created_by: String,

    pub id: String,

    pub name: String,

    pub newsletter_id: Option<String>,

    pub thumbnail: Option<String>,
}

