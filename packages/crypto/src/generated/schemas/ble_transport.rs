//! BleTransport module schema types
//!
//! @generated from protocol/schemas/core/ble-transport/v1.json
//! Version: 1.0.0
//! Min Reader Version: 1.0.0
//!
//! DO NOT EDIT - This file is auto-generated by tools/codegen using quicktype

use serde::{Deserialize, Serialize};

/// Schema version for BleTransport module
pub const BLE_TRANSPORT_VERSION: &str = "1.0.0";
/// Minimum reader version for BleTransport module
pub const BLE_TRANSPORT_MIN_READER_VERSION: &str = "1.0.0";

/// BLE identity commitment for mutual authentication handshake
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct IdentityCommitment {
    #[serde(rename = "_v")]
    pub v: String,

    /// Base64-encoded commitment hash
    pub commitment: String,

    /// Base64-encoded random nonce
    pub nonce: String,

    /// Hex-encoded public key
    pub pubkey: String,
}

/// A BLE device discovered during scanning
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct DiscoveredDevice {
    #[serde(rename = "_v")]
    pub v: String,

    /// BLE device address
    pub address: String,

    /// Base64-encoded identity commitment if available
    pub identity_commitment: Option<String>,

    /// Whether the device is a BuildIt node
    pub is_buildit_device: bool,

    /// Unix timestamp (milliseconds)
    pub last_seen: i64,

    /// Advertised device name
    pub name: Option<String>,

    /// Signal strength in dBm
    pub rssi: Option<i64>,

    /// Hex-encoded verified public key after handshake
    pub verified_pubkey: Option<String>,
}

/// A BLE mesh event notification
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct BleEvent {
    #[serde(rename = "_v")]
    pub v: String,

    /// Device address for device events
    pub address: Option<String>,

    pub status: Option<ConnectionStatus>,

    /// Event type
    #[serde(rename = "type")]
    pub ble_event_type: Type,
}

/// Event type
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Type {
    #[serde(rename = "connection_changed")]
    ConnectionChanged,

    #[serde(rename = "device_discovered")]
    DeviceDiscovered,

    #[serde(rename = "device_lost")]
    DeviceLost,

    #[serde(rename = "device_updated")]
    DeviceUpdated,

    #[serde(rename = "message_received")]
    MessageReceived,

    #[serde(rename = "message_sent")]
    MessageSent,
}

/// BLE connection state
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum ConnectionStatus {
    Authenticated,

    Connected,

    Connecting,

    Disconnected,

    Disconnecting,

    Handshaking,
}

/// Header for BLE message chunking protocol
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ChunkHeader {
    #[serde(rename = "_v")]
    pub v: String,

    /// Zero-based chunk index
    pub chunk_index: i64,

    /// Whether payload is zlib-compressed
    pub compressed: bool,

    /// Unique message identifier
    pub message_id: String,

    /// Payload size in bytes
    pub payload_length: i64,

    /// Total number of chunks
    pub total_chunks: i64,
}

/// A single BLE message chunk
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Chunk {
    #[serde(rename = "_v")]
    pub v: String,

    pub header: HeaderClass,

    /// Base64-encoded chunk payload
    pub payload: String,
}

/// Header for BLE message chunking protocol
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct HeaderClass {
    #[serde(rename = "_v")]
    pub v: String,

    /// Zero-based chunk index
    pub chunk_index: i64,

    /// Whether payload is zlib-compressed
    pub compressed: bool,

    /// Unique message identifier
    pub message_id: String,

    /// Payload size in bytes
    pub payload_length: i64,

    /// Total number of chunks
    pub total_chunks: i64,
}

