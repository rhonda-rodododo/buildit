//! Calling module schema types
//!
//! @generated from protocol/schemas/modules/calling/v1.json
//! Version: 1.0.0
//! Min Reader Version: 1.0.0
//!
//! DO NOT EDIT - This file is auto-generated by tools/codegen using quicktype

use serde::{Deserialize, Serialize};

/// Schema version for Calling module
pub const CALLING_VERSION: &str = "1.0.0";
/// Minimum reader version for Calling module
pub const CALLING_MIN_READER_VERSION: &str = "1.0.0";

use std::collections::HashMap;

/// WebRTC call offer with SDP (wrapped in NIP-17)
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallOffer {
    /// Schema version
    #[serde(rename = "_v")]
    pub v: String,

    /// Unique identifier for this call session
    pub call_id: String,

    /// Type of call being initiated
    pub call_type: CallType,

    pub capabilities: Option<CapabilitiesClass>,

    /// Optional group context for the call
    pub group_id: Option<String>,

    /// Hotline ID if calling a hotline
    pub hotline_id: Option<String>,

    /// True if this is a reconnection attempt
    pub is_reconnect: Option<bool>,

    /// True if adding/removing tracks mid-call
    pub is_renegotiation: Option<bool>,

    /// Group call room ID for mesh/SFU
    pub room_id: Option<String>,

    /// SDP offer (Session Description Protocol)
    pub sdp: String,

    /// Unix timestamp of offer creation
    pub timestamp: i64,
}

/// Type of call being initiated
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum CallType {
    Video,

    Voice,
}

/// Caller capabilities
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CapabilitiesClass {
    #[serde(rename = "e2ee")]
    pub e2_ee: Option<bool>,

    pub insertable_streams: Option<bool>,

    pub screen_share: Option<bool>,

    pub video: Option<bool>,
}

/// WebRTC call answer with SDP
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallAnswer {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_id: String,

    /// SDP answer
    pub sdp: String,

    pub timestamp: i64,
}

/// ICE candidate for connection negotiation
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallIceCandidate {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_id: String,

    /// RTCIceCandidate serialized
    pub candidate: Candidate,
}

/// RTCIceCandidate serialized
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Candidate {
    pub candidate: Option<String>,

    pub sdp_mid: Option<String>,

    pub sdp_m_line_index: Option<i64>,

    pub username_fragment: Option<String>,
}

/// Call termination signal
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallHangup {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_id: String,

    /// Reason for call termination
    pub reason: Reason,

    pub timestamp: Option<i64>,
}

/// Reason for call termination
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Reason {
    Busy,

    Cancelled,

    Completed,

    #[serde(rename = "network_failure")]
    NetworkFailure,

    #[serde(rename = "no_answer")]
    NoAnswer,

    Rejected,

    Timeout,
}

/// Caller capabilities
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallCapabilities {
    #[serde(rename = "e2ee")]
    pub e2_ee: Option<bool>,

    pub insertable_streams: Option<bool>,

    pub screen_share: Option<bool>,

    pub video: Option<bool>,
}

/// Local call state tracking
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallState {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_id: String,

    pub call_type: Option<CallType>,

    /// Unix timestamp when call connected
    pub connected_at: Option<i64>,

    pub direction: Direction,

    /// Unix timestamp when call ended
    pub ended_at: Option<i64>,

    pub end_reason: Option<Reason>,

    pub is_encrypted: Option<bool>,

    pub is_muted: Option<bool>,

    pub is_screen_sharing: Option<bool>,

    pub is_video_enabled: Option<bool>,

    pub quality: Option<QualityClass>,

    /// Display name of remote party
    pub remote_name: Option<String>,

    /// Nostr pubkey of the other party
    pub remote_pubkey: String,

    /// Unix timestamp when call was initiated
    pub started_at: i64,

    pub state: CallStateState,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Direction {
    Incoming,

    Outgoing,
}

/// Call quality metrics
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct QualityClass {
    /// 0-1 normalized
    pub audio_level: Option<f64>,

    /// Bits per second
    pub bandwidth: Option<i64>,

    /// Milliseconds
    pub jitter: Option<f64>,

    /// Percentage 0-100
    pub packet_loss: Option<f64>,

    /// Milliseconds
    pub round_trip_time: Option<f64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum CallStateState {
    Connected,

    Connecting,

    Ended,

    Initiating,

    #[serde(rename = "on_hold")]
    OnHold,

    Reconnecting,

    Ringing,
}

/// Call quality metrics
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallQuality {
    /// 0-1 normalized
    pub audio_level: Option<f64>,

    /// Bits per second
    pub bandwidth: Option<i64>,

    /// Milliseconds
    pub jitter: Option<f64>,

    /// Percentage 0-100
    pub packet_loss: Option<f64>,

    /// Milliseconds
    pub round_trip_time: Option<f64>,
}

/// Create a new group call room
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct GroupCallCreate {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_type: CallType,

    pub created_by: String,

    /// BuildIt group context
    pub group_id: Option<String>,

    pub invited_pubkeys: Option<Vec<String>>,

    pub max_participants: Option<i64>,

    pub room_id: String,

    pub timestamp: i64,

    pub topology: Option<Topology>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Topology {
    Mesh,

    Sfu,
}

/// Join an existing group call
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct GroupCallJoin {
    #[serde(rename = "_v")]
    pub v: String,

    pub display_name: Option<String>,

    pub pubkey: String,

    pub room_id: String,

    pub timestamp: i64,
}

/// Leave a group call
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct GroupCallLeave {
    #[serde(rename = "_v")]
    pub v: String,

    pub pubkey: String,

    pub room_id: String,

    pub timestamp: i64,
}

/// Participant in a group call
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct GroupCallParticipant {
    pub audio_enabled: Option<bool>,

    pub display_name: Option<String>,

    pub is_host: Option<bool>,

    pub is_speaking: Option<bool>,

    pub joined_at: i64,

    pub pubkey: String,

    pub screen_sharing: Option<bool>,

    pub state: GroupCallParticipantState,

    pub video_enabled: Option<bool>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum GroupCallParticipantState {
    Connected,

    Connecting,

    Left,

    Reconnecting,
}

/// Distribute sender key for group E2EE
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SenderKeyDistribution {
    #[serde(rename = "_v")]
    pub v: String,

    /// Map of recipient pubkey to NIP-44 encrypted key
    pub encrypted_keys: HashMap<String, String>,

    /// Key ID for rotation tracking
    pub key_id: i64,

    pub room_id: String,

    pub sender_pubkey: String,

    pub timestamp: Option<i64>,
}

/// Persistent call log entry
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallHistory {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_id: String,

    pub call_type: Option<CallHistoryCallType>,

    pub connected_at: Option<i64>,

    pub direction: Direction,

    /// Duration in seconds
    pub duration: Option<i64>,

    pub ended_at: Option<i64>,

    pub end_reason: Option<Reason>,

    pub group_id: Option<String>,

    /// For group calls
    pub participant_count: Option<i64>,

    pub remote_name: Option<String>,

    pub remote_pubkey: String,

    pub room_id: Option<String>,

    pub started_at: i64,

    pub was_encrypted: Option<bool>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum CallHistoryCallType {
    Group,

    Video,

    Voice,
}

/// User call preferences
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CallSettings {
    #[serde(rename = "_v")]
    pub v: Option<String>,

    pub allow_unknown_callers: Option<bool>,

    pub auto_answer: Option<bool>,

    pub auto_gain_control: Option<bool>,

    pub default_call_type: Option<CallType>,

    pub do_not_disturb: Option<bool>,

    pub echo_cancellation: Option<bool>,

    pub noise_suppression: Option<bool>,

    pub preferred_audio_input: Option<String>,

    pub preferred_audio_output: Option<String>,

    pub preferred_video_input: Option<String>,

    /// Always use TURN relay for privacy
    pub relay_only_mode: Option<bool>,
}

/// Extended call state for hotline calls
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct HotlineCallState {
    #[serde(rename = "_v")]
    pub v: String,

    pub answered_at: Option<i64>,

    pub caller: Option<Caller>,

    pub call_id: String,

    pub call_type: HotlineCallStateCallType,

    pub category: Option<String>,

    pub ended_at: Option<i64>,

    pub group_id: Option<String>,

    pub hotline_id: String,

    pub is_encrypted: Option<bool>,

    pub notes: Option<String>,

    pub operator: Option<Operator>,

    pub priority: Option<HotlineCallStatePriority>,

    pub queued_at: Option<i64>,

    pub queue_position: Option<i64>,

    pub state: HotlineCallStateState,

    /// Seconds in queue
    pub wait_duration: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum HotlineCallStateCallType {
    Internal,

    Pstn,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Caller {
    pub name: Option<String>,

    pub phone: Option<String>,

    pub pubkey: Option<String>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Operator {
    pub name: Option<String>,

    pub pubkey: Option<String>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum HotlineCallStatePriority {
    High,

    Low,

    Medium,

    Urgent,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum HotlineCallStateState {
    Abandoned,

    Active,

    Completed,

    Escalated,

    #[serde(rename = "on_hold")]
    OnHold,

    Queued,

    Ringing,

    Transferred,
}

/// Operator availability status
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct HotlineOperatorStatus {
    #[serde(rename = "_v")]
    pub v: String,

    pub call_count: Option<i64>,

    pub current_call_id: Option<String>,

    pub hotline_id: String,

    pub pubkey: String,

    pub shift_end: Option<i64>,

    pub shift_start: Option<i64>,

    pub status: HotlineOperatorStatusStatus,

    pub timestamp: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum HotlineOperatorStatusStatus {
    Available,

    Break,

    Offline,

    #[serde(rename = "on_call")]
    OnCall,

    #[serde(rename = "wrap_up")]
    WrapUp,
}

/// Current queue status for a hotline
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct HotlineQueueState {
    #[serde(rename = "_v")]
    pub v: String,

    pub calls: Vec<Call>,

    /// Seconds
    pub estimated_wait_time: Option<i64>,

    pub hotline_id: String,

    pub operators_available: Option<i64>,

    pub timestamp: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Call {
    pub caller_name: Option<String>,

    pub call_id: Option<String>,

    pub position: Option<i64>,

    pub priority: Option<String>,

    pub queued_at: Option<i64>,
}

/// Text-based hotline conversation thread
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct MessagingHotlineThread {
    #[serde(rename = "_v")]
    pub v: String,

    pub assigned_operator: Option<String>,

    pub category: Option<String>,

    pub contact: Option<Contact>,

    pub created_at: i64,

    pub group_id: Option<String>,

    pub hotline_id: String,

    pub last_message_at: Option<i64>,

    pub last_message_by: Option<LastMessageBy>,

    /// If escalated to voice
    pub linked_call_id: Option<String>,

    pub message_count: Option<i64>,

    pub priority: Option<HotlineCallStatePriority>,

    pub resolved_at: Option<i64>,

    pub status: MessagingHotlineThreadStatus,

    pub thread_id: String,

    pub unread_by_operator: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Contact {
    pub name: Option<String>,

    pub phone: Option<String>,

    pub pubkey: Option<String>,

    #[serde(rename = "type")]
    pub contact_type: Option<Type>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Type {
    Buildit,

    Rcs,

    Sms,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum LastMessageBy {
    Contact,

    Operator,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum MessagingHotlineThreadStatus {
    Active,

    Archived,

    Assigned,

    Resolved,

    Unassigned,

    Waiting,
}

/// Message broadcast/blast
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Broadcast {
    #[serde(rename = "_v")]
    pub v: String,

    pub analytics: Option<Analytics>,

    pub broadcast_id: String,

    pub content: String,

    pub created_by: String,

    pub priority: Option<BroadcastPriority>,

    pub scheduled_at: Option<i64>,

    pub sent_at: Option<i64>,

    pub status: Option<BroadcastStatus>,

    pub target_ids: Option<Vec<String>>,

    pub target_type: TargetType,

    pub title: Option<String>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Analytics {
    pub delivered: Option<i64>,

    pub read: Option<i64>,

    pub replied: Option<i64>,

    pub total_recipients: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum BroadcastPriority {
    Emergency,

    High,

    Normal,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum BroadcastStatus {
    Draft,

    Failed,

    Scheduled,

    Sending,

    Sent,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum TargetType {
    #[serde(rename = "contact_list")]
    ContactList,

    Emergency,

    Group,

    #[serde(rename = "public_channel")]
    PublicChannel,
}

/// SFU-based conference room
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ConferenceRoom {
    #[serde(rename = "_v")]
    pub v: String,

    pub created_at: Option<i64>,

    pub created_by: String,

    pub expires_at: Option<i64>,

    pub group_id: Option<String>,

    pub max_participants: Option<i64>,

    pub name: String,

    pub room_id: String,

    pub settings: Option<Settings>,

    pub sfu_endpoint: Option<String>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Settings {
    pub allow_recording: Option<bool>,

    pub allow_screen_share: Option<bool>,

    #[serde(rename = "e2eeRequired")]
    pub e2_ee_required: Option<bool>,

    pub locked: Option<bool>,

    pub waiting_room: Option<bool>,
}

/// Breakout room configuration
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct BreakoutConfig {
    #[serde(rename = "_v")]
    pub v: String,

    pub allow_self_select: Option<bool>,

    pub auto_assign: Option<bool>,

    pub breakouts: Vec<Breakout>,

    pub created_at: Option<i64>,

    pub created_by: Option<String>,

    /// Seconds, 0 for unlimited
    pub duration: Option<i64>,

    pub main_room_id: String,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct Breakout {
    pub capacity: Option<i64>,

    pub id: String,

    pub name: String,

    pub participants: Option<Vec<String>>,
}

