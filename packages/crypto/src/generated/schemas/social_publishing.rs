//! SocialPublishing module schema types
//!
//! @generated from protocol/schemas/modules/social-publishing/v1.json
//! Version: 1.0.0
//! Min Reader Version: 1.0.0
//!
//! DO NOT EDIT - This file is auto-generated by tools/codegen using quicktype

use serde::{Deserialize, Serialize};

/// Schema version for SocialPublishing module
pub const SOCIAL_PUBLISHING_VERSION: &str = "1.0.0";
/// Minimum reader version for SocialPublishing module
pub const SOCIAL_PUBLISHING_MIN_READER_VERSION: &str = "1.0.0";

/// Wraps content from any module with scheduling metadata. The centralized scheduling type —
/// avoids adding scheduledAt to every module's schema.
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ScheduledContent {
    /// Schema version that created this content
    #[serde(rename = "_v")]
    pub v: String,

    /// Creation timestamp (Unix seconds)
    pub created_at: i64,

    /// Creator's public key (hex)
    pub created_by: String,

    pub cross_post_config: Option<CrossPostConfigClass>,

    /// Error details if status is 'failed'
    pub error_message: Option<String>,

    /// Unique scheduled content identifier
    pub id: String,

    /// When the content was actually published (Unix timestamp seconds)
    pub published_at: Option<i64>,

    pub recurrence: Option<RecurrenceClass>,

    /// Number of publish attempts
    pub retry_count: Option<i64>,

    /// When to publish (Unix timestamp seconds)
    pub scheduled_at: i64,

    /// Pre-signed Nostr event JSON. Client signs, server relays at publish time (zero-knowledge).
    pub signed_event: Option<String>,

    /// ID of the content item in the source module
    pub source_content_id: String,

    /// Module that owns the content (e.g., 'publishing', 'microblogging', 'events')
    pub source_module: String,

    /// Current scheduling status
    pub status: ScheduledContentStatus,

    /// Last update timestamp (Unix seconds)
    pub updated_at: Option<i64>,
}

/// Per-scheduled-item cross-posting configuration — which platforms to post to
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct CrossPostConfigClass {
    #[serde(rename = "_v")]
    pub v: String,

    /// Platform-specific post configurations
    pub platforms: Vec<CrossPostConfigPlatform>,
}

/// Individual platform entry for cross-posting
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CrossPostConfigPlatform {
    #[serde(rename = "_v")]
    pub v: String,

    /// Platform-specific content override (e.g., shorter text for Bluesky's 300 char limit)
    pub custom_content: Option<String>,

    /// Whether to post to this platform
    pub enabled: bool,

    /// Error details if this platform failed
    pub error_message: Option<String>,

    /// Target platform
    pub platform: PlatformElement,

    /// URL of the published post on the target platform
    pub published_url: Option<String>,

    /// Per-platform publish status
    pub status: Option<PlatformStatus>,
}

/// Target platform
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum PlatformElement {
    Activitypub,

    Atproto,

    Nostr,

    Rss,
}

/// Per-platform publish status
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum PlatformStatus {
    Failed,

    Pending,

    Published,
}

/// Recurrence rule for scheduled content (iCal-style)
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct RecurrenceClass {
    pub by_day: Option<Vec<ByDay>>,

    /// Number of occurrences
    pub count: Option<i64>,

    pub frequency: Frequency,

    pub interval: Option<i64>,

    /// End date as Unix timestamp
    pub until: Option<i64>,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub enum ByDay {
    #[serde(rename = "FR")]
    Fr,

    #[serde(rename = "MO")]
    Mo,

    #[serde(rename = "SA")]
    Sa,

    #[serde(rename = "SU")]
    Su,

    #[serde(rename = "TH")]
    Th,

    #[serde(rename = "TU")]
    Tu,

    #[serde(rename = "WE")]
    We,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum Frequency {
    Daily,

    Monthly,

    Weekly,
}

/// Current scheduling status
///
/// Publishing status
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum ScheduledContentStatus {
    Cancelled,

    Failed,

    Pending,

    Published,

    Publishing,
}

/// Per-scheduled-item cross-posting configuration — which platforms to post to
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct CrossPostConfig {
    #[serde(rename = "_v")]
    pub v: String,

    /// Platform-specific post configurations
    pub platforms: Vec<CrossPostConfigPlatformClass>,
}

/// Individual platform entry for cross-posting
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CrossPostConfigPlatformClass {
    #[serde(rename = "_v")]
    pub v: String,

    /// Platform-specific content override (e.g., shorter text for Bluesky's 300 char limit)
    pub custom_content: Option<String>,

    /// Whether to post to this platform
    pub enabled: bool,

    /// Error details if this platform failed
    pub error_message: Option<String>,

    /// Target platform
    pub platform: PlatformElement,

    /// URL of the published post on the target platform
    pub published_url: Option<String>,

    /// Per-platform publish status
    pub status: Option<PlatformStatus>,
}

/// Individual platform entry for cross-posting
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct PlatformPost {
    #[serde(rename = "_v")]
    pub v: String,

    /// Platform-specific content override (e.g., shorter text for Bluesky's 300 char limit)
    pub custom_content: Option<String>,

    /// Whether to post to this platform
    pub enabled: bool,

    /// Error details if this platform failed
    pub error_message: Option<String>,

    /// Target platform
    pub platform: PlatformElement,

    /// URL of the published post on the target platform
    pub published_url: Option<String>,

    /// Per-platform publish status
    pub status: Option<PlatformStatus>,
}

/// Recurrence rule for scheduled content (iCal-style)
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct RecurrenceRule {
    pub by_day: Option<Vec<ByDay>>,

    /// Number of occurrences
    pub count: Option<i64>,

    pub frequency: Frequency,

    pub interval: Option<i64>,

    /// End date as Unix timestamp
    pub until: Option<i64>,
}

/// Connected external social account for cross-posting. Extends federation's
/// FederationIdentity with scheduling metadata.
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SocialAccount {
    #[serde(rename = "_v")]
    pub v: String,

    /// Avatar URL on the external platform
    pub avatar_url: Option<String>,

    /// When the account was connected (Unix seconds)
    pub created_at: i64,

    /// Display name on the external platform
    pub display_name: Option<String>,

    /// Account handle on the platform (e.g., '@user@mastodon.social' or 'user.bsky.social')
    pub handle: String,

    /// Unique account identifier
    pub id: String,

    /// Whether the account is currently connected and usable
    pub is_active: Option<bool>,

    /// Last time the account status was verified
    pub last_sync_at: Option<i64>,

    /// External platform type
    pub platform: SocialAccountPlatform,

    /// Associated Nostr pubkey
    pub pubkey: String,
}

/// External platform type
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum SocialAccountPlatform {
    Activitypub,

    Atproto,
}

/// Generated public share URL with optional password, expiration, and click tracking
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ShareLink {
    #[serde(rename = "_v")]
    pub v: String,

    /// Total click count
    pub click_count: Option<i64>,

    /// Creation timestamp (Unix seconds)
    pub created_at: i64,

    /// Creator's public key (hex)
    pub created_by: String,

    /// Optional expiration (Unix timestamp seconds)
    pub expires_at: Option<i64>,

    /// Unique share link identifier
    pub id: String,

    /// Whether the share link is active
    pub is_active: Option<bool>,

    /// Optional Argon2id hash of access password
    pub password_hash: Option<String>,

    pub seo_overrides: Option<SeoOverridesClass>,

    /// Short URL slug (nanoid-based, 8 chars default)
    pub slug: String,

    /// ID of the content item in the source module
    pub source_content_id: String,

    /// Module that owns the shared content
    pub source_module: String,

    /// Full URL the share link resolves to
    pub target_url: Option<String>,

    /// Whether to record privacy-preserving click analytics
    pub track_clicks: Option<bool>,
}

/// Custom SEO metadata overrides for share links and content
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SeoOverridesClass {
    #[serde(rename = "_v")]
    pub v: Option<String>,

    /// Custom canonical URL
    pub canonical_url: Option<String>,

    /// Custom meta description
    pub description: Option<String>,

    /// SEO keywords
    pub keywords: Option<Vec<String>>,

    /// Custom OG image URL (overrides auto-generated)
    pub og_image_url: Option<String>,

    /// Custom meta title
    pub title: Option<String>,
}

/// Custom SEO metadata overrides for share links and content
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SeoOverrides {
    #[serde(rename = "_v")]
    pub v: Option<String>,

    /// Custom canonical URL
    pub canonical_url: Option<String>,

    /// Custom meta description
    pub description: Option<String>,

    /// SEO keywords
    pub keywords: Option<Vec<String>>,

    /// Custom OG image URL (overrides auto-generated)
    pub og_image_url: Option<String>,

    /// Custom meta title
    pub title: Option<String>,
}

/// Denormalized view entry for the content calendar aggregation
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ContentCalendarEntry {
    #[serde(rename = "_v")]
    pub v: String,

    /// Type of content for color-coding
    pub content_type: Option<ContentType>,

    /// Calendar entry identifier
    pub id: String,

    /// Target platforms for this content
    pub platforms: Option<Vec<PlatformElement>>,

    /// Scheduled time (Unix timestamp seconds)
    pub scheduled_at: i64,

    /// Content item ID in the source module
    pub source_content_id: String,

    /// Originating module
    pub source_module: String,

    /// Publishing status
    pub status: ScheduledContentStatus,

    /// Content title for calendar display
    pub title: String,
}

/// Type of content for color-coding
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum ContentType {
    Article,

    Event,

    Listing,

    Newsletter,

    Post,
}

/// Privacy-preserving per-share analytics. Session-based, no user identification, no cookies.
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct OutreachAnalytics {
    #[serde(rename = "_v")]
    pub v: String,

    /// Unique analytics entry identifier
    pub id: String,

    /// Detected platform (e.g., 'mastodon', 'bluesky', 'twitter', 'email', 'direct')
    pub platform: Option<String>,

    /// Referring domain (stripped to domain only for privacy)
    pub referrer: Option<String>,

    /// Random session identifier (not tied to user identity)
    pub session_id: String,

    /// Share link that was clicked
    pub share_link_id: String,

    /// Click timestamp (Unix seconds)
    pub timestamp: i64,
}

