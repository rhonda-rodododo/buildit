//! Federation module schema types
//!
//! @generated from protocol/schemas/modules/federation/v1.json
//! Version: 1.0.0
//! Min Reader Version: 1.0.0
//!
//! DO NOT EDIT - This file is auto-generated by tools/codegen using quicktype

use serde::{Deserialize, Serialize};

/// Schema version for Federation module
pub const FEDERATION_VERSION: &str = "1.0.0";
/// Minimum reader version for Federation module
pub const FEDERATION_MIN_READER_VERSION: &str = "1.0.0";

/// Per-identity federation configuration
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct FederationConfig {
    /// Schema version for graceful degradation
    #[serde(rename = "_v")]
    pub v: String,

    /// Whether ActivityPub federation is enabled
    pub ap_enabled: bool,

    /// Whether AT Protocol (Bluesky) federation is enabled
    pub at_enabled: bool,

    /// Bluesky handle (e.g., user.bsky.social)
    pub at_handle: Option<String>,

    /// Hex-encoded Nostr public key
    pub nostr_pubkey: String,

    /// Federation username (e.g., user@buildit.network)
    pub username: Option<String>,
}

/// Federation status for a specific post/event
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct FederationStatus {
    /// Schema version for graceful degradation
    #[serde(rename = "_v")]
    pub v: String,

    /// The AP activity ID if federated
    pub ap_activity_id: Option<String>,

    /// Whether this event has been federated via ActivityPub
    pub ap_federated: Option<bool>,

    /// Whether this event has been cross-posted to AT Protocol
    pub at_federated: Option<bool>,

    /// The AT Protocol URI if cross-posted
    pub at_uri: Option<String>,

    /// ISO 8601 timestamp of when the event was federated
    pub federated_at: Option<String>,

    /// The Nostr event ID this status refers to
    pub nostr_event_id: String,
}

/// An incoming interaction from a federated platform
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct FederationInteraction {
    /// Schema version for graceful degradation
    #[serde(rename = "_v")]
    pub v: String,

    /// Content of the interaction (e.g., reply text)
    pub content: Option<String>,

    /// Unique interaction ID
    pub id: Option<i64>,

    /// Type of interaction
    pub interaction_type: InteractionType,

    /// When BuildIt received this interaction
    pub received_at: Option<String>,

    /// The remote actor's identifier (AP actor URI or AT DID)
    pub source_actor_id: String,

    /// Human-readable name of the remote actor
    pub source_actor_name: Option<String>,

    /// Which federated protocol this came from
    pub source_protocol: SourceProtocol,

    /// URL to the interaction on its home platform
    pub source_url: Option<String>,

    /// The Nostr event this interaction targets
    pub target_nostr_event_id: Option<String>,
}

/// Type of interaction
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum InteractionType {
    Like,

    Reply,

    Repost,
}

/// Which federated protocol this came from
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum SourceProtocol {
    Activitypub,

    Atproto,
}

/// Maps a Nostr pubkey to ActivityPub and AT Protocol accounts
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct FederationIdentity {
    #[serde(rename = "_v")]
    pub v: String,

    pub ap_actor_id: Option<String>,

    pub ap_enabled: bool,

    /// Encrypted AP private key
    pub ap_private_key: Option<String>,

    pub at_did: Option<String>,

    pub at_enabled: bool,

    pub at_handle: Option<String>,

    pub at_session_encrypted: Option<String>,

    pub created_at: String,

    pub nostr_pubkey: String,

    pub updated_at: String,

    pub username: String,
}

/// ActivityPub follower relationship record
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct ApFollower {
    #[serde(rename = "_v")]
    pub v: String,

    pub accepted_at: String,

    pub id: Option<i64>,

    /// Local actor username
    pub local_actor: String,

    /// Remote AP actor URI
    pub remote_actor_id: String,

    /// Remote actor's inbox URL
    pub remote_inbox: String,

    /// Remote actor's shared inbox URL
    pub remote_shared_inbox: Option<String>,
}

/// Tracks a post federated across Nostr, AP, and AT Protocol
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct FederatedPost {
    #[serde(rename = "_v")]
    pub v: String,

    pub ap_activity_id: Option<String>,

    pub at_cid: Option<String>,

    pub at_uri: Option<String>,

    pub federated_at: String,

    pub nostr_event_id: String,

    pub nostr_pubkey: String,
}

