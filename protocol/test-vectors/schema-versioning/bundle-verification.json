{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema Bundle Verification Test Vectors",
  "description": "Test vectors for schema bundle signature verification and application",

  "metadata": {
    "version": "2.0.0",
    "lastUpdated": "2026-02-05",
    "specification": "../spec/08-schema-versioning.md"
  },

  "trustedSigners": [
    {
      "name": "BuildIt Official (2026-02)",
      "publicKey": "44470946c302a9349de9e332ac5496a70ecc7d26bb52b149eea51897b16a771c",
      "note": "Official BuildIt bundle signing key"
    },
    {
      "name": "Test Signer (DO NOT use in production)",
      "publicKey": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
      "note": "Placeholder for untrusted signer tests"
    }
  ],

  "testSuites": [
    {
      "name": "Bundle Signature Verification",
      "description": "Tests for Ed25519 signature verification of schema bundles",
      "cases": [
        {
          "name": "valid_bundle_signature",
          "description": "Bundle with valid Ed25519 signature from trusted signer",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {
              "events": {
                "version": "1.0.0",
                "schema": {}
              }
            },
            "contentHash": "c54bb8bbc0dba1176b06bcb7a2682d76c95e16fbaa5a4b1b234a6823c3f15a45",
            "signature": "c37bf8ffa2b842952d977c8d0176a813ae3f753dae2e61d5e49e4e267ce000dc4647b7642f17fdafeed2c639487ae0d17a989018ef0b17ce7945e6cf9b581d08",
            "signedBy": "44470946c302a9349de9e332ac5496a70ecc7d26bb52b149eea51897b16a771c"
          },
          "expected": {
            "signatureValid": true,
            "signerTrusted": true,
            "shouldApply": true
          },
          "note": "contentHash is SHA-256 of JSON.stringify(schemas, null, 0). Signature is Ed25519 over the raw content hash bytes."
        },
        {
          "name": "invalid_signature",
          "description": "Bundle with tampered signature should be rejected",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {
              "events": {
                "version": "1.0.0",
                "schema": {}
              }
            },
            "contentHash": "c54bb8bbc0dba1176b06bcb7a2682d76c95e16fbaa5a4b1b234a6823c3f15a45",
            "signature": "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "signedBy": "44470946c302a9349de9e332ac5496a70ecc7d26bb52b149eea51897b16a771c"
          },
          "expected": {
            "signatureValid": false,
            "shouldApply": false,
            "error": "INVALID_SIGNATURE"
          }
        },
        {
          "name": "untrusted_signer",
          "description": "Bundle signed by key not in trusted set",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {},
            "contentHash": "44136fa355b311bfa706c3a13290e1b3047aa030c38f51e5a8e3350f9e7b4e0d",
            "signature": "deadbeef00000000000000000000000000000000000000000000000000000000deadbeef00000000000000000000000000000000000000000000000000000000",
            "signedBy": "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
          },
          "expected": {
            "signatureValid": false,
            "signerTrusted": false,
            "shouldApply": false,
            "error": "UNTRUSTED_SIGNER"
          }
        },
        {
          "name": "missing_signature",
          "description": "Bundle without signature field should be rejected",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {}
          },
          "expected": {
            "shouldApply": false,
            "error": "MISSING_SIGNATURE"
          }
        },
        {
          "name": "content_hash_mismatch",
          "description": "Bundle with valid signature but modified content should fail hash check",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {
              "events": {
                "version": "1.0.0",
                "schema": {"tampered": true}
              }
            },
            "contentHash": "c54bb8bbc0dba1176b06bcb7a2682d76c95e16fbaa5a4b1b234a6823c3f15a45",
            "signature": "c37bf8ffa2b842952d977c8d0176a813ae3f753dae2e61d5e49e4e267ce000dc4647b7642f17fdafeed2c639487ae0d17a989018ef0b17ce7945e6cf9b581d08",
            "signedBy": "44470946c302a9349de9e332ac5496a70ecc7d26bb52b149eea51897b16a771c"
          },
          "expected": {
            "signatureValid": false,
            "shouldApply": false,
            "error": "CONTENT_HASH_MISMATCH"
          },
          "note": "The signature was created for the original schemas (without tampered:true), so the content hash won't match the modified schemas."
        },
        {
          "name": "empty_schemas_object",
          "description": "Bundle with empty schemas object should be rejected",
          "bundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0",
            "schemas": {},
            "contentHash": "44136fa355b311bfa706c3a13290e1b3047aa030c38f51e5a8e3350f9e7b4e0d",
            "signature": "c37bf8ffa2b842952d977c8d0176a813ae3f753dae2e61d5e49e4e267ce000dc4647b7642f17fdafeed2c639487ae0d17a989018ef0b17ce7945e6cf9b581d08",
            "signedBy": "44470946c302a9349de9e332ac5496a70ecc7d26bb52b149eea51897b16a771c"
          },
          "expected": {
            "shouldApply": false,
            "error": "EMPTY_BUNDLE"
          }
        }
      ]
    },
    {
      "name": "Bundle Version Checking",
      "description": "Tests for bundle freshness and version requirements",
      "cases": [
        {
          "name": "newer_bundle",
          "description": "Bundle is newer than current - should apply",
          "currentBundle": {
            "version": "1.0.0",
            "createdAt": 1706000000
          },
          "newBundle": {
            "bundleVersion": "1.1.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0"
          },
          "clientVersion": "0.2.0",
          "expected": {
            "shouldApply": true
          }
        },
        {
          "name": "older_bundle",
          "description": "Bundle is older than current - should not apply",
          "currentBundle": {
            "version": "1.1.0",
            "createdAt": 1706198400
          },
          "newBundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706000000,
            "minClientVersion": "0.1.0"
          },
          "clientVersion": "0.2.0",
          "expected": {
            "shouldApply": false,
            "reason": "BUNDLE_OUTDATED"
          }
        },
        {
          "name": "same_timestamp",
          "description": "Bundle has same timestamp as current - should not apply",
          "currentBundle": {
            "version": "1.0.0",
            "createdAt": 1706198400
          },
          "newBundle": {
            "bundleVersion": "1.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.1.0"
          },
          "clientVersion": "0.2.0",
          "expected": {
            "shouldApply": false,
            "reason": "BUNDLE_NOT_NEWER"
          }
        },
        {
          "name": "client_too_old",
          "description": "Client version below bundle requirement",
          "currentBundle": null,
          "newBundle": {
            "bundleVersion": "2.0.0",
            "createdAt": 1706198400,
            "minClientVersion": "0.5.0"
          },
          "clientVersion": "0.3.0",
          "expected": {
            "shouldApply": false,
            "error": "CLIENT_UPDATE_REQUIRED",
            "requiredVersion": "0.5.0"
          }
        }
      ]
    },
    {
      "name": "BLE Schema Sync",
      "description": "Tests for schema bundle exchange over BLE",
      "cases": [
        {
          "name": "peer_has_newer_bundle",
          "description": "Peer advertises newer schema bundle - should request",
          "myDeviceInfo": {
            "schemaBundleVersion": "1.0.0",
            "schemaBundleCreatedAt": 1706000000
          },
          "peerDeviceInfo": {
            "schemaBundleVersion": "1.2.0",
            "schemaBundleCreatedAt": 1706198400
          },
          "expected": {
            "shouldRequestBundle": true
          }
        },
        {
          "name": "peer_has_older_bundle",
          "description": "Peer has older schema bundle - should offer ours",
          "myDeviceInfo": {
            "schemaBundleVersion": "1.2.0",
            "schemaBundleCreatedAt": 1706198400
          },
          "peerDeviceInfo": {
            "schemaBundleVersion": "1.0.0",
            "schemaBundleCreatedAt": 1706000000
          },
          "expected": {
            "shouldRequestBundle": false,
            "shouldOfferBundle": true
          }
        },
        {
          "name": "same_bundle_version",
          "description": "Both devices have same bundle - no action needed",
          "myDeviceInfo": {
            "schemaBundleVersion": "1.0.0",
            "schemaBundleCreatedAt": 1706000000
          },
          "peerDeviceInfo": {
            "schemaBundleVersion": "1.0.0",
            "schemaBundleCreatedAt": 1706000000
          },
          "expected": {
            "shouldRequestBundle": false,
            "shouldOfferBundle": false
          }
        }
      ]
    }
  ]
}
